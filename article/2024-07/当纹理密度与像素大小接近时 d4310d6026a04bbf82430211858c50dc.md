# 当纹理密度与像素大小接近时

Title: 当纹理密度与像素大小接近时

Date: 2024-7-24

Keywords: Math, Coding, Imaging

---

由于像素内函数值剧烈变化，导致像素无法准确代表单一值，尤其在高频震荡区域。这种失真不仅由于浮点数计算误差，更涉及信号采样问题。根据奈奎斯特采样定理，当信号频率过高时，像素无法还原原始信号，从而产生失真图像。

这个东西十分有趣，所以记录下来。

---

[toc]

## 现象：出现失真的函数图像

偶然看到这么一个说法，那就是科学绘图时，在绘制以下函数的解时会出现不好看的图

$$
sin(x^2+y^2)=0.5
$$

如下图所示，左图（`value`）是$f(x, y)$的函数图像

$$
f(x, y) = sin(x^2+y^2)
$$

右图（`contour`）是$g(x, y)$的函数图像

$$
g(x, y) = e^{-(f-r)^2}, r\in(0, 1)
$$

易见，当$x, y$的取值距离$0$点较远时，图像出现了较为严重的失真现象。因为由简单三角函数的性质可知，它的图像应该是由越来越密集的、互不接触的圆环构成。起初我以为这种失真是由于浮点数计算$sin(\cdot)$是丢失精度导致的，但经过分析可知，事情比随机噪声要有趣得多。

![Untitled](%E5%BD%93%E7%BA%B9%E7%90%86%E5%AF%86%E5%BA%A6%E4%B8%8E%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F%E6%8E%A5%E8%BF%91%E6%97%B6%20d4310d6026a04bbf82430211858c50dc/Untitled.png)

![Untitled](%E5%BD%93%E7%BA%B9%E7%90%86%E5%AF%86%E5%BA%A6%E4%B8%8E%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F%E6%8E%A5%E8%BF%91%E6%97%B6%20d4310d6026a04bbf82430211858c50dc/Untitled%201.png)

## 分析：像素是对信号的采样

长话短说，这是一个采样问题。在一般情况下，在绘图时我们认为一个像素只对应一个值。不管用何种数值表示它，它都是颜色显示的最小单元。

![Untitled](%E5%BD%93%E7%BA%B9%E7%90%86%E5%AF%86%E5%BA%A6%E4%B8%8E%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F%E6%8E%A5%E8%BF%91%E6%97%B6%20d4310d6026a04bbf82430211858c50dc/Untitled%202.png)

但在本文的绘图情境下，函数在一个像素内发现了激烈的变化，为了简单起见，我们做简单的旋转变换，只需要考虑函数$h(x)=sin(x^2)$，它的自变量按二次函数增长，采用微分符号将像素长度记为$dx$，增长率为

$$
\frac{d}{dx}x^2=2x
$$

采用如下参数时，不同的$x$值对应$h(x)$不同的震荡范围

```python
scaler = 20
pixel_size = 1/100
```

下图展示了三种典型值情况，两种颜色代表了两个相邻的像素内的函数值变化，从左到右，

- 最左侧当其值较小时，相邻像素中的值具有较强的区分度，因此从两段曲线中任意取一点作为该像素的值都不影响像素之间的大小关系；
- 中间当其值增大时，就可能出现两个相邻像素内的数值分布相近的情况，在这样的情况下，需要特别小心地选取像素值才能避免它们发生混淆；
- 以上这些还在奈奎斯特采样定理范围之内，也就是说仍然有希望从像素的采样值”还原“出原始的连续信号；
- 最右侧是当其值更大时，此时像素的范围内已经几乎容纳了一个整周期内的全部可能取值，此时无论怎样选择采样规则，都已经无法还原出原始的连续信号。

![Untitled](%E5%BD%93%E7%BA%B9%E7%90%86%E5%AF%86%E5%BA%A6%E4%B8%8E%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F%E6%8E%A5%E8%BF%91%E6%97%B6%20d4310d6026a04bbf82430211858c50dc/Untitled%203.png)

因此，这些诡异的波纹是由于像素内函数值发生”剧烈“变化，此时像素不再只是一个单纯的点而对应一段取值多样的连续信号。在绘图时，如果对于每个像素只是机械地任由程序选择某一个值，那么就会出现下图中的不良伪影。

![Untitled](%E5%BD%93%E7%BA%B9%E7%90%86%E5%AF%86%E5%BA%A6%E4%B8%8E%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F%E6%8E%A5%E8%BF%91%E6%97%B6%20d4310d6026a04bbf82430211858c50dc/Untitled%204.png)

之后将介绍如何规避这种不良伪影的情况，题目初步定为”噪声是我们的朋友“。
