# 噪声数值取整的均值误差分析

Title: 噪声数值取整的均值误差分析
Date: 2024-8-9
Keywords: Noise, Quantization

---

在计算机处理数字时，必然会对它们进行量化。而在有噪声存在的情况下，量化值的均值会呈现出有趣的行为。在本文的例子中，当噪声较小时，量化值的均值与离散的量化值相近；而当噪声较大时，量化值的均值却与量化之前的原始连续值相近。

经简单推导可知，这似乎与正态分布的累积分布函数的形状有关。本文的可交互代码可见我的开源笔记本。

[Quantization error](https://observablehq.com/@listenzcc/quantization-error)

---

## 取整与噪声数值取整的均值

考虑实数$x \in \mathcal{R}$，它的取整操作是将它转换为整数

$$
y=\lfloor x + 0.5 \rfloor
$$

这是一种四舍五入取整的方法。考虑随机变量$Z$

$$
z=x+\epsilon, \epsilon \sim \mathcal{N}(\mu, \sigma^2)
$$

我们感兴趣的是它的量化值的期望

$$
E(W), w=\lfloor z \rfloor
$$

下面四张图从左到右分别代表

![Untitled](%E5%99%AA%E5%A3%B0%E6%95%B0%E5%80%BC%E5%8F%96%E6%95%B4%E7%9A%84%E5%9D%87%E5%80%BC%E8%AF%AF%E5%B7%AE%E5%88%86%E6%9E%90%2098131b44b78440bd90390fcd09bc563a/Untitled.png)

1. 从黑到白分别代表$x$从低到高排列。
2. 取整得到$y$。
3. 将$x$增加噪声得到$z$，图像中的多列代表多次独立采样。
4. $z$的量化值，即$w$。

接下来将第四张图按列进行平均就得到$E(W)$的无偏估计，可以用来考察它与$y$值之间的差异。分析结果表明差异受噪声大小的影响。

### 小噪声场景

当噪声较小时，噪声取整的均值接近原始取整值。

![Untitled](%E5%99%AA%E5%A3%B0%E6%95%B0%E5%80%BC%E5%8F%96%E6%95%B4%E7%9A%84%E5%9D%87%E5%80%BC%E8%AF%AF%E5%B7%AE%E5%88%86%E6%9E%90%2098131b44b78440bd90390fcd09bc563a/Untitled%201.png)

### 大噪声场景

当噪声较大时，噪声取整的均值接近原始连续值。

![Untitled](%E5%99%AA%E5%A3%B0%E6%95%B0%E5%80%BC%E5%8F%96%E6%95%B4%E7%9A%84%E5%9D%87%E5%80%BC%E8%AF%AF%E5%B7%AE%E5%88%86%E6%9E%90%2098131b44b78440bd90390fcd09bc563a/Untitled%202.png)

## 数值分析

由于取整的余数具有周期性，因此考虑$0$附近的任意数值

$$
x\in (-0.5, 0.5)
$$

其对应的$y$值均为$0$。当噪声存在时，需要分情况讨论

- 当噪声$\epsilon \gt 0.5 - x$时，对应的$w$值比$y$值增加$1$。
- 当噪声继续增加到$\epsilon \gt 1.5 - x$，对应的$w$值比$y$值在之前的基础上又增加$1$。
- 由于前一种情况包含后一种情况，因此将它们累加起来即可。

又由于噪声服从正态分布，因此在噪声为正时$w$值产生正偏的期望为

$$
\sum_{k=0}^{\infty}1-F(k+0.5-x)
$$

其中，$F(\cdot)$为累积分布函数。同理可推负偏时的期望为

$$
\sum_{k=0}^{-\infty}-F(k-0.5-x)
$$

正、负两项相加并经整理得误差的期望为

$$
\sum_{k=0}^{\infty}F(-k-0.5+x) - F(-k-0.5-x)
$$

结合正态分布的累积分布函数来看，在小噪声场景中（$\sigma^2$较小时），$F$函数很快地收敛到两端的极值，因此受$x$值影响较小，量化误差趋向于$0$。在大噪声场景中（$\sigma^2$较大时），量化误差受$x$的影响较大，导致量化后的均值反而与量化前的均值相似。

![Untitled](%E5%99%AA%E5%A3%B0%E6%95%B0%E5%80%BC%E5%8F%96%E6%95%B4%E7%9A%84%E5%9D%87%E5%80%BC%E8%AF%AF%E5%B7%AE%E5%88%86%E6%9E%90%2098131b44b78440bd90390fcd09bc563a/Untitled%203.png)

在下图中，我还将误差水平调整到一个不高不低的位置，其误差曲线与累积分布曲线也有一定相似性。


![Untitled](%E5%99%AA%E5%A3%B0%E6%95%B0%E5%80%BC%E5%8F%96%E6%95%B4%E7%9A%84%E5%9D%87%E5%80%BC%E8%AF%AF%E5%B7%AE%E5%88%86%E6%9E%90%2098131b44b78440bd90390fcd09bc563a/Untitled%204.png)
