# 核函数方法构造可微的直方图PDF

Title: 核函数方法构造可微的直方图PDF
Date: 2024-6-30
Keywords: PDF, Statistic

---

核密度估计（KDE）通过对数据点应用平滑函数（如高斯核）来构建连续的概率密度函数（PDF），克服了直方图的离散性。KDE生成的PDF是连续且可微的，适用于需要连续可微函数的应用场景，如神经网络的训练。KDE的导函数也是可计算的，使其在机器学习和统计分析中非常有用。

---

## 直方图与PDF之间的关系

直方图是数据分布的离散表示，通过将数据分割成一系列的桶（bin），统计每个桶中的数据点数量来反映数据的分布情况。然而，直方图只能在有限的区间内表示数据分布，且依赖于分桶的选择。相比之下，概率密度函数（`PDF`）是数据分布的连续表示，提供了更精确的概率密度信息。核密度估计（`KDE`）是一种常用的方法，通过平滑直方图得到连续的PDF，从而弥补直方图的不足。

## 可微是神经网络可训练的基础

在神经网络的训练过程中，反向传播算法依赖于损失函数对网络参数的导数。因此，模型的各个部分需要是可微的，才能有效地计算梯度并更新参数。核密度估计生成的PDF是连续且可微的，这使得它可以用于神经网络的损失函数或其他需要连续可微函数的场景中。

## 核函数方法从直方图中提取`PDF`

`KDE`是一种从直方图中提取平滑`PDF`的非参数方法。下面是核密度估计的数学原理推导和其导函数的计算。

### 简要原理

给定一个样本数据集 $\{x_1, x_2, \ldots, x_n\}$，核密度估计的公式为：

$$
\hat{f}(x) = \frac{1}{n h} \sum_{i=1}^{n} K\left( \frac{x - x_i}{h} \right)
$$

其中：

- $\hat{f}(x)$ 是估计的概率密度函数。
- $n$ 是样本数量。
- $h$ 是带宽参数，决定了平滑程度。
- $K$ 是核函数，常用的核函数是高斯核：

$$
K(u) = \frac{1}{\sqrt{2\pi}} e^{-\frac{u^2}{2}}
$$

将高斯核代入核密度估计公式中，我们得到：

$$
\hat{f}(x) = \frac{1}{n h \sqrt{2\pi}} \sum_{i=1}^{n} e^{-\frac{(x - x_i)^2}{2h^2}}
$$

### 导函数计算

为了计算核密度估计的导函数 $\hat{f}'(x)$，我们需要对 $\hat{f}(x)$ 进行求导。考虑到高斯核函数的导数，我们有：

$$
K'(u) = -u K(u)
$$

因此，核密度估计的导函数可以表示为：

$$
\hat{f}'(x) = \frac{1}{n h} \sum_{i=1}^{n} K'\left( \frac{x - x_i}{h} \right)
$$

对于高斯核，我们有：

$$
K'\left( \frac{x - x_i}{h} \right) = -\frac{x - x_i}{h} K\left( \frac{x - x_i}{h} \right)
$$

将其代入，我们得到：

$$
\hat{f}'(x) = \frac{1}{n h} \sum_{i=1}^{n} -\frac{x - x_i}{h} \frac{1}{\sqrt{2\pi}} e^{-\frac{(x - x_i)^2}{2h^2}}
$$

$$
\hat{f}'(x) = -\frac{1}{n h^2 \sqrt{2\pi}} \sum_{i=1}^{n} (x - x_i) e^{-\frac{(x - x_i)^2}{2h^2}}
$$

## 以图像为例，构造可微的颜色`PDF`

以下是我以`6`张彩图为例，用核函数方法计算它们的颜色`PDF`，并进行横向比较的结果。其中，实线和虚线分别2种不同的核函数参数，实线为高斯核的`KDE`方法，虚数为`sklearn.stats.gaussian_kde`包的`scott`方法。

![Untitled](%E6%A0%B8%E5%87%BD%E6%95%B0%E6%96%B9%E6%B3%95%E6%9E%84%E9%80%A0%E5%8F%AF%E5%BE%AE%E7%9A%84%E7%9B%B4%E6%96%B9%E5%9B%BEPDF%201bc70617570141eb88640def2cf81465/Untitled.png)

![Untitled](%E6%A0%B8%E5%87%BD%E6%95%B0%E6%96%B9%E6%B3%95%E6%9E%84%E9%80%A0%E5%8F%AF%E5%BE%AE%E7%9A%84%E7%9B%B4%E6%96%B9%E5%9B%BEPDF%201bc70617570141eb88640def2cf81465/Untitled%201.png)
